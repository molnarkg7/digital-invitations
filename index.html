<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="styles.css">
  <script src="script.js" defer></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <link rel="icon" type="image/png" href="assets/srce.png" />
  <title>Dejan & Jovana</title>
</head>

<body>
  <section id="intro">
    <img style="border-radius: 10px;" src="assets/pozivnica.jpg">
    <p class="pozivnicaText">Dragi naši, <br /> Sa velikom radošću i još većom dozom uzbuđenja, pozivamo Vas da budete
      deo dana,
      kada ćemo reći "DA" i zvanično postati tim za ceo život!</p>
  </section>

  <div class="section-divider">
    <span class="line"></span>
    <span class="stars">♥</span>
    <span class="line"></span>
  </div>

  <section style="margin-top: 0;" id="countdown">
    <h2>Odbrojavanje do našeg velikog dana</h2>
    <div class="countdown-grid">
      <div class="time-box">
        <span id="days">0</span>
        <small>Dana</small>
      </div>
      <div class="time-box">
        <span id="hours">0</span>
        <small>Sati</small>
      </div>
      <div class="time-box">
        <span id="minutes">0</span>
        <small>Minuta</small>
      </div>
      <div class="time-box">
        <span id="seconds">0</span>
        <small>Sekundi</small>
      </div>
    </div>
  </section>

  <div class="section-divider">
    <span class="line"></span>
    <span class="stars">♥</span>
    <span class="line"></span>
  </div>

  <section style="margin-top: 0;" id="location">
    <h2>Lokacija</h2>
    <img src="assets/lokacija.png" style="width: 30px; height: 30px;" srcset="">
    <h3>Restoran Ribarac</h3>
    <p>Ribarsko Ostrvo, Novi Sad, Srbija</p>
    <iframe
      src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3355.0134735573674!2d19.8333761!3d45.230207099999994!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x475b1004a8a3c90d%3A0xb9e6ff46e15340e7!2sRestoran%20Ribarac!5e1!3m2!1ssr!2srs!4v1768432482317!5m2!1ssr!2srs"
      allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    <a href="https://www.google.com/maps/place/Restoran+Ribarac/@45.2302108,19.8308012,770m/data=!3m2!1e3!4b1!4m6!3m5!1s0x475b1004a8a3c90d:0xb9e6ff46e15340e7!8m2!3d45.2302071!4d19.8333761!16s%2Fg%2F1txnn7jh?entry=ttu&g_ep=EgoyMDI2MDEyMC4wIKXMDSoKLDEwMDc5MjA2N0gBUAM%3D"
      target="_blank"
      style="display:inline-block;margin-top:10px;padding:8px 15px;background:#422e16;color:white;border-radius:5px;text-decoration:none;">
      Prikaži u Google Maps
    </a>
  </section>

  <div class="section-divider">
    <span class="line"></span>
    <span class="stars">♥</span>
    <span class="line"></span>
  </div>

  <section style="margin-top: 0;" id="plan">
    <h2>Program dana</h2>
    <div class="timeline">

      <div class="timeline-item">
        <div class="time">12:00</div>
        <div class="circle"><i class="fa-solid fa-users"></i></div>
        <div class="label"><b>Skup svatova</b><br />Dvorište restorana Ribarac, Zajednički polazak u crkvu 13:00h</div>
      </div>

      <div class="timeline-item">
        <div class="time">13:30</div>
        <div class="circle"><i class="fa-solid fa-church"></i></div>
        <div class="label"><b>Crkveno venčanje</b><br />Hram Svetog Simeona Mirotočivog (Ive Lole Ribara 1, Veternik)
        </div>
      </div>

      <div class="timeline-item">
        <div class="time">16:00</div>
        <div class="circle"><i class="fa-solid fa-utensils"></i></div>
        <div class="label"><b>Ručak</b><br />Restoran Ribarac</b></div>
      </div>

      <div class="timeline-item">
        <div class="time">18:30</div>
        <div class="circle"><i class="fa-solid fa-heart"></i></div>
        <div class="label"><b>Građansko venčanje</b><br />Restoran Ribarac</div>
      </div>

      <div class="timeline-item">
        <div class="time">00:00</div>
        <div class="circle"><i class="fa-solid fa-hourglass-end"></i></div>
        <div class="label"><b>Kraj</b></div>
      </div>

    </div>
  </section>

  <div class="section-divider">
    <span class="line"></span>
    <span class="stars">♥</span>
    <span class="line"></span>
  </div>

  <section style="margin-top: 0;">
    <p>Molimo Vas da u nastavku pozivnice potvrdite svoj dolazak i navedete broj osoba koje sa Vama dolaze, najkasnije
      do
      1.8.2026.</p>
  </section>

  <section style="margin-top: 0;" id="form">
    <p>Radujemo se Vašem prisustvu!</p>

    <form id="weddingForm">

      <label style="text-align: center;">Da li dolazite?</label>
      <div class="toggle-group">
        <input type="radio" id="yes" name="attendance" value="yes" required>
        <label for="yes" class="toggle">Da</label>

        <input type="radio" id="no" name="attendance" value="no" required>
        <label for="no" class="toggle">Ne</label>
      </div>

      <input type="text" id="full_name" placeholder="Ime i prezime" required />

      <label style="padding-top: 20px;" for="options" class="attendanceLabel">Sa koliko osoba dolazite?</label>
      <select id="options" required disabled>
        <option value="">Izaberi...</option>
        <option value="0">Dolazim sam</option>
        <option value="1">+1</option>
        <option value="2">+2</option>
        <option value="3">+3</option>
        <option value="4">+4</option>
        <option value="5">+5</option>
        <option value="6">+6</option>
        <option value="7">+7</option>
        <option value="8">+8</option>
        <option value="9">+9</option>
      </select>

      <div id="additionalGuests"></div>

      <button type="submit" id="submitBtn" disabled>
        Pošalji <i class="fa-solid fa-arrow-up-right-from-square"></i>
      </button>

    </form>

    <script>
      const form = document.getElementById('weddingForm');
      const submitBtn = document.getElementById('submitBtn');
      const optionsSelect = document.getElementById('options');
      const guestsContainer = document.getElementById('additionalGuests');
      const attendanceRadios = document.querySelectorAll('input[name="attendance"]');
      const attendanceLabel = document.querySelector('.attendanceLabel');

      const checkFormValidity = () => {
        submitBtn.disabled = !form.checkValidity();
      };

      attendanceRadios.forEach(radio => {
        radio.addEventListener('change', () => {
          if (radio.value === 'yes') {
            optionsSelect.disabled = false;
            optionsSelect.required = true;
            attendanceLabel.style.display = '';
          } else {
            optionsSelect.value = '';
            optionsSelect.disabled = true;
            optionsSelect.required = false;
            guestsContainer.innerHTML = '';
            attendanceLabel.style.display = 'none';
          }


          checkFormValidity();
        });
      });

      optionsSelect.addEventListener('change', function () {
        const numberOfGuests = parseInt(this.value || 0);
        guestsContainer.innerHTML = '';

        for (let i = 1; i <= numberOfGuests; i++) {
          const label = document.createElement('label');
          label.textContent = `Ime i prezime ${i + 1}. gosta`;

          const input = document.createElement('input');
          input.type = 'text';
          input.name = `guest_${i}`;
          input.placeholder = 'Ime i prezime';
          input.required = true;

          input.addEventListener('input', checkFormValidity);

          guestsContainer.appendChild(label);
          guestsContainer.appendChild(input);
        }

        checkFormValidity();
      });

      form.addEventListener('input', checkFormValidity);
      form.addEventListener('change', checkFormValidity);
    </script>
  </section>

  <section id="footer" style="margin-bottom: 30px;">
    <h3>Očekujemo Vas!</h3>
    <h3 style="font-style: italic; margin-top: 20px;">S ljubavlju,</h3>
    <h2 style="font-style: italic;">Dejan & Jovana</h2>
    <p>Septembar 19, 2026</p>
  </section>

  <button id="downloadExcel" class="excel-btn">
    <i class="fa-solid fa-file-excel"></i> Preuzmi Excel
  </button>

  <script type="module">
    import { getDocs } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCcIti9WCKIv1MLyGiBWLIuu3gS7MNsphc",
      authDomain: "digital-invitations-a2d32.firebaseapp.com",
      projectId: "digital-invitations-a2d32",
      storageBucket: "digital-invitations-a2d32.firebasestorage.app",
      messagingSenderId: "552488253368",
      appId: "1:552488253368:web:2ed144c19dd3b06d7ec14d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const fullName = document.getElementById("full_name").value.trim();
      const attendance = document.querySelector(
        'input[name="attendance"]:checked'
      ).value;

      const isComing = attendance === "yes";
      const companionsCount = isComing ? Number(document.getElementById("options").value) : 0;

      const companions = [];
      if (isComing && companionsCount > 0) {
        for (let i = 1; i <= companionsCount; i++) {
          const guestInput = document.querySelector(`input[name="guest_${i}"]`);
          if (guestInput && guestInput.value.trim() !== "") {
            companions.push({ full_name: guestInput.value.trim() });
          }
        }
      }

      try {
        await addDoc(collection(db, "guests"), {
          full_name: fullName,
          is_coming: isComing,
          companions_count: companionsCount,
          companions: companions,
          createdAt: serverTimestamp()
        });

        alert("Hvala! Vaš odgovor je uspešno poslat. Radujemo se što ćete biti deo našeg velikog dana! ❤️");
        form.reset();

        document.getElementById("additionalGuests").innerHTML = "";
        document.getElementById("options").disabled = true;
        submitBtn.disabled = true;
      } catch (err) {
        console.error(err);
        alert("Došlo je do greške. Pokušajte ponovo.");
      }
    });

    //excel logika

    const downloadBtn = document.getElementById("downloadExcel");

    downloadBtn.addEventListener("click", async () => {
      try {
        const querySnapshot = await getDocs(collection(db, "guests"));
        const data = [];

        querySnapshot.forEach((doc) => {
          const docData = doc.data();

          const row = {
            "Ime i prezime": docData.full_name,
            "Dolazi": docData.is_coming ? "Dolazi" : "Ne dolazi",
            "Broj pratilaca": docData.companions_count
          };

          if (docData.companions && docData.companions.length > 0) {
            docData.companions.forEach((comp, index) => {
              row[`Gost ${index + 1}`] = comp.full_name;
            });
          }

          data.push(row);
        });

        const ws = XLSX.utils.json_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Gosti");

        XLSX.writeFile(wb, "Gosti.xlsx");

      } catch (err) {
        console.error(err);
        alert("Došlo je do greške prilikom preuzimanja Excel fajla.");
      }
    });

  </script>

</body>

</html>